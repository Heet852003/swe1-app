language: python
dist: focal    # Ubuntu 20.04 - stable Travis CI environment

python:
  - "3.11"

cache: pip

# 🧪 Install dependencies (main + dev)
install:
  - pip install -r requirements.txt
  - pip install -r requirements-dev.txt

# ⚙️ Before tests: migrate DB and collect static files
before_script:
  - python manage.py migrate --noinput
  - python manage.py collectstatic --noinput

# ✅ Run tests, linting, and coverage
script:
  - black --check .
  - flake8 .
  - coverage run --source=mysite,polls manage.py test

# 📊 Upload coverage report
after_success:
  - coveralls

# 🚀 Deploy to AWS Elastic Beanstalk (only when tests pass on main)
deploy:
  provider: elasticbeanstalk
  edge: true
  region: "us-east-1"                    # ✅ make sure this matches your EB region
  app: "swe1-app"                        # ✅ exact name of your EB Application
  env: "swe1-env"                        # ✅ exact name of your EB Environment
  bucket_name: "elasticbeanstalk-us-east-1-817896957697"  # ✅ remove accidental space
  on:
    branch: main
