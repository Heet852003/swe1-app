language: python
dist: focal    # Ubuntu 20.04 (stable Travis CI environment)

python:
  - "3.11"

cache: pip

# ğŸ§ª Install dependencies (normal + dev)
install:
  - pip install -r requirements.txt
  - pip install -r requirements-dev.txt

# âš™ï¸ Before tests: prepare database + static files
before_script:
  - python manage.py migrate --noinput
  - python manage.py collectstatic --noinput

# âœ… What Travis will run for each build
script:
  - black --check .
  - flake8 .
  - coverage run --source=mysite,polls manage.py test

# ğŸ“Š After tests: send coverage to Coveralls
after_success:
  - coveralls

# ğŸš€ Deploy to AWS Elastic Beanstalk **only when main branch passes all tests**
deploy:
  provider: elasticbeanstalk
  edge: true             # Use dpl v2 (recommended)
  region: "us-east-1"    # âœ… change if your EB is in another region
  app: "swe1-app"        # âœ… your EB Application name
  env: "swe1-env"        # âœ… your EB Environment name
  bucket: "	elasticbeanstalk-us-east-1-817896957697"  # âœ… your S3 bucket name
  on:
    branch: main
